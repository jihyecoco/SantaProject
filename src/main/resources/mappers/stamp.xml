<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="stamp.StampBean">
	
	<resultMap type="com.spring.ex.stamp.model.StampBean" id="stampMap">
		<id property="stampnum" column="stamp_num"/>
		<result property="mountainnum" column="mountain_num"/>
		<result property="usersid" column="users_id"/>
		<result property="stampimage" column="stamp_image"/>
		<result property="stampapply" column="stamp_apply"/>
		<result property="stampreject" column="stamp_reject"/>
	</resultMap>

	<resultMap type="com.spring.ex.stamp.model.CertBean" id="certMap">
		<result property="mountainname" column="mountain_name"/>
		<result property="stampapply" column="stamp_apply"/>
		<result property="stampimage" column="stamp_image"/>
		<result property="usersid" column="users_id"/>
		<result property="stampreject" column="stamp_reject"/>
	</resultMap>

	<select id="GetAllStampById" resultType="com.spring.ex.stamp.model.StampBean" resultMap="stampMap">
		SELECT
			stamp_num,
			mountain_num,
			users_id,
			stamp_image,
			stamp_apply,
			stamp_reject
		FROM
			stamp
		WHERE
			users_id = #{userid}
	</select>
	
	<select id="GetAllStamp" resultType="com.spring.ex.stamp.model.StampBean" resultMap="stampMap">
		SELECT
			stamp_num,
			mountain_num,
			users_id,
			stamp_image,
			stamp_apply,
			stamp_reject
		FROM
			stamp
		<if test="whatColumn == '아이디'">
			WHERE
				users_id like #{keyword}
		</if>
	</select>
	
	<select id="GetUserRoleById" resultType="String">
		SELECT
			user_role
		FROM
			users
		WHERE
			user_id = #{userid}
	</select>
	
	<select id="GetCertListById" resultType="com.spring.ex.stamp.model.CertBean" resultMap="certMap">
		SELECT
			mountain_name,
			stamp_apply,
			users_id,
			stamp_reject
		FROM
			stamp NATURAL JOIN mountain
		WHERE
			users_id = #{userid}
	</select>

	<select id="GetNumByName" resultType="String">
	SELECT
		mountain_num
 	FROM
		mountain
	WHERE
		mountain_name = #{mountainname}
	</select>
	
	<insert id="InsertStampCert">
		INSERT INTO
			stamp(
			stamp_num,
			mountain_num,
			users_id,
			stamp_image,
			stamp_apply,
			stamp_reject)
		VALUES(
			stamp_seq.nextval,
			#{mountainnum},
			#{usersid},
			#{stampimage},
			0,
			0)
	</insert>
	
	<select id="GetStampTotalCount" resultType="int">
		SELECT
			count(*)
		FROM
			stamp
		<if test='whatColumn == "아이디"'>
 			where users_id like #{keyword}
 		</if>
	</select>

	<select id="GetCertByNum" resultType="com.spring.ex.stamp.model.CertBean" resultMap="certMap">
		SELECT
			mountain_name,
			stamp_apply,
			users_id,
			stamp_reject
		FROM
			stamp NATURAL JOIN mountain
		WHERE
			stamp_num = #{stampnum}
	</select>
	
	<update id="UpdateApply">
		UPDATE
			stamp
		SET
			stamp_apply = #{stampapply}
			<if test="stampapply != 2">
				, stamp_reject = null
			</if>
		WHERE
			stamp_num = #{stampnum}
	</update>

	<update id="UpdateReject">
		UPDATE
			stamp
		SET
			stamp_reject = #{stampreject}
		WHERE
			stamp_num = #{stampnum}
	</update>
</mapper>